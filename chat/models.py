from django.db import models
import openai
from flask import Flask, request, jsonify

openai.api_key = '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'
app = Flask(__name__)


@app.route('/chat', methods=['POST'])
def chat():
    data = request.json
    question = data['question']
    response = generate_response(question)
    return jsonify({'response': response})


if __name__ == '__main__':
    app.run()

legal_keywords = ['закон', 'уголовный кодекс', 'гражданский кодекс', 'административный кодекс', 'трудовой кодекс',
                'налоговый кодекс', 'по закону КР', 'по законам КР', 'по уголовному кодексу', 'что мне грозит', 'КР', 'Кыргызская Республика',
                'уголовно-процессуальный кодекс', 'гражданско-процессуальный кодекс', 'административно-процессуальный кодекс', 'земельный кодекс', 'жилищный кодекс', 'автотранспортный кодекс', 'морской кодекс', 'воздушный кодекс', 'таможенный кодекс', 'кодекс торгового мореплавания',
                'кодекс внутреннего водного транспорта', 'кодекс воздушного транспорта', 'кодекс автодорог', 'кодекс железнодорожного транспорта', 'кодекс административного судопроизводства', 'кодекс гражданского судопроизводства', 'кодекс арбитражного процесса', 'кодекс трудового суда', 
                'кодекс административной ответственности', 'кодекс об административных правонарушениях', 'кодекс труда', 'кодекс о социальном обеспечении', 'кодекс о налогах и сборах', 'кодекс о защите прав потребителей', 'кодекс о банкротстве', 'кодекс о недрах', 'кодекс о защите окружающей среды', 
                'кодекс о водных ресурсах', 'кодекс о миграции', 'кодекс о гражданстве', 'кодекс о внешнеторговой деятельности', 'кодекс о правах интеллектуальной собственности', 'кодекс о семье', 'кодекс о брачных отношениях', 'кодекс о наследовании', 'кодекс о детях и их правах', 'кодекс о молодежи', 'кодекс о защите труда', 
                'кодекс о социальном обслуживании', 'кодекс о здравоохранении', 'кодекс об административных правонарушениях в сфере дорожного движения', 'кодекс о защите персональных данных', 'кодекс о защите конкуренции', 'кодекс о защите прав инвесторов', 'кодекс о защите авторских прав',
                'кодекс о защите прав потребителей в сфере электронной коммерции', 'кодекс о защите информации', 'кодекс о защите прав детей', 'кодекс о защите от нарушений в сфере туризма', 'кодекс о защите от домашнего насилия', 'кодекс о защите от дискриминации', 'кодекс о защите от коррупции', 'кодекс о защите от нарушений экологического законодательства',
                'кодекс о защите от незаконного оборота наркотиков', 'кодекс о защите от терроризма', 'кодекс о защите от мошенничества', 'кодекс о защите от преступлений в сфере информационных технологий', 'кодекс о защите от преступлений в сфере финансов', 'кодекс о защите от преступлений в сфере кибербезопасности', 
                'кодекс о защите от преступлений против государственной безопасности', 'кодекс о защите от преступлений против собственности', 'кодекс о защите от преступлений против личности', 'кодекс о защите от преступлений против сексуальной неприкосновенности', 'кодекс о защите от преступлений против здоровья', 'кодекс о защите от преступлений против чести и достоинства', 
                'кодекс о защите от преступлений против публичного порядка', 'кодекс о защите от преступлений против мира и безопасности человечества', 'кодекс о защите от преступлений против сферы экономики', 'кодекс о защите от преступлений против финансовой системы', 'кодекс о защите от преступлений против информационной безопасности',
                'кодекс о защите от преступлений против культурного наследия', 'кодекс о защите от преступлений против национальной безопасности', 'кодекс о защите от преступлений против государственной тайны', 'кодекс о защите от преступлений против общественной безопасности', 'кодекс о защите от преступлений против сферы информационных технологий',
                'кодекс о защите от преступлений против интеллектуальной собственности', 'кодекс о защите от преступлений против туристической безопасности', 'кодекс о защите от преступлений против международной безопасности', 'кодекс о защите от преступлений против энергетической безопасности', 'кодекс о защите от преступлений против публичного здоровья','закон', 'уголовный кодекс', 'гражданский кодекс', 'административный кодекс', 'трудовой кодекс',
                'налоговый кодекс', 'по закону КР', 'по законам КР', 'по уголовному кодексу', 'что мне грозит'
                'кодекс о защите от преступлений против окружающей среды', 'кодекс о защите от преступлений против животных', 'кодекс о защите от преступлений против прав человека', 'кодекс о защите от преступлений против детей', 'кодекс о защите от преступлений против мира и безопасности', 'кодекс о защите от преступлений против гражданской авиации', 
                'кодекс о защите от преступлений против морской безопасности', 'кодекс о защите от преступлений против кибербезопасности', 'кодекс о защите от преступлений против финансовой безопасности', 'кодекс о защите от преступлений против государственной безопасности в информационной сфере', 'кодекс о защите от преступлений против национальной безопасности в сфере информационных технологий', 
                'кодекс о защите от преступлений против прав человека в Кыргызской Республике', 'кодекс о защите от преступлений против детей в Кыргызской Республике', 'кодекс о защите от преступлений против мира и безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против животных в Кыргызской Республике', 'кодекс о защите от преступлений против окружающей среды в Кыргызской Республике', 
                'кодекс о защите от преступлений против здоровья населения в Кыргызской Республике', 'кодекс о защите от преступлений против прав потребителей в Кыргызской Республике', 'кодекс о защите от преступлений против информационной безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против туристической безопасности в Кыргызской Республике', 
                'кодекс о защите от преступлений против гражданской авиации в Кыргызской Республике', 'кодекс о защите от преступлений против государственной тайны в Кыргызской Республике', 'кодекс о защите от преступлений против национальной безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против культурного наследия в Кыргызской Республике', 
                'кодекс о защите от преступлений против общественной безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против экономической безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против финансовой безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против государственной безопасности в Кыргызской Республике', 
                'кодекс о защите от преступлений против государственных интересов в Кыргызской Республике', 'кодекс о защите от преступлений против национальной безопасности в Кыргызской Республике', 'кодекс о защите от преступлений против суверенитета в Кыргызской Республике', 'кодекс о защите от преступлений против конституционного строя в Кыргызской Республике', 
                'кодекс о защите от преступлений против государственной символики в Кыргызской Республике', 'кодекс о защите от преступлений против государственной тайны в Кыргызской Республике', 'кодекс о защите от преступлений против государственной собственности в Кыргызской Республике', 'кодекс о защите от преступлений против государственного бюджета в Кыргызской Республике']


def is_legal_question(question):
    question = question.lower()
    for keyword in legal_keywords:
        if keyword in question:
            return True
    return False


def generate_response(question):
    if not is_legal_question(question):
        return "Извините, я могу отвечать только на вопросы, связанные с законами Кыргызской Республики."

    response = openai.Completion.create(
        engine='text-davinci-003',
        prompt=question,
        max_tokens=3000,
        n=1,
        stop=None,
    )
    answer = response.choices[0].text.strip()
    return answer


if __name__ == '__main__':
    app.run()

